var Sk=Sk||{};function hasOwnProperty(t,e){var n=t.constructor.prototype;return e in t&&(!(e in n)||n[e]!==t[e])}Sk.Breakpoint=function(t,e,n){this.filename=t,this.lineno=e,this.colno=n,this.enabled=!0,this.ignore_count=0},Sk.Debugger=function(t,e){this.dbg_breakpoints={},this.tmp_breakpoints={},this.suspension_stack=[],this.current_suspension=-1,this.eval_callback=null,this.suspension=null,this.output_callback=e,this.step_mode=!1,this.filename=t},Sk.Debugger.prototype.print=function(t){null!=this.output_callback&&this.output_callback.print(t)},Sk.Debugger.prototype.get_source_line=function(t){return null!=this.output_callback?this.output_callback.get_source_line(t):""},Sk.Debugger.prototype.move_up_the_stack=function(){this.current_suspension=Math.min(this.current_suspension+1,this.suspension_stack.length-1)},Sk.Debugger.prototype.move_down_the_stack=function(){this.current_suspension=Math.max(this.current_suspension-1,0)},Sk.Debugger.prototype.enable_step_mode=function(){this.step_mode=!0},Sk.Debugger.prototype.disable_step_mode=function(){this.step_mode=!1},Sk.Debugger.prototype.get_suspension_stack=function(){return this.suspension_stack},Sk.Debugger.prototype.get_active_suspension=function(){return 0===this.suspension_stack.length?null:this.suspension_stack[this.current_suspension]},Sk.Debugger.prototype.generate_breakpoint_key=function(t,e,n){return t+"-"+e},Sk.Debugger.prototype.check_breakpoints=function(t,e,n,s,i){if(!0===this.step_mode)return!0;t=this.generate_breakpoint_key(t,e,n);return!(!hasOwnProperty(this.dbg_breakpoints,t)||!0!==this.dbg_breakpoints[t].enabled)&&(hasOwnProperty(this.tmp_breakpoints,t)?(delete this.dbg_breakpoints[t],delete this.tmp_breakpoints[t],!0):(--this.dbg_breakpoints[t].ignore_count,this.dbg_breakpoints[t].ignore_count=Math.max(0,this.dbg_breakpoints[t].ignore_count),0===this.dbg_breakpoints[t].ignore_count))},Sk.Debugger.prototype.get_breakpoints_list=function(){return this.dbg_breakpoints},Sk.Debugger.prototype.disable_breakpoint=function(t,e,n){t=this.generate_breakpoint_key(t,e,n);hasOwnProperty(this.dbg_breakpoints,t)&&(this.dbg_breakpoints[t].enabled=!1)},Sk.Debugger.prototype.enable_breakpoint=function(t,e,n){t=this.generate_breakpoint_key(t,e,n);hasOwnProperty(this.dbg_breakpoints,t)&&(this.dbg_breakpoints[t].enabled=!0)},Sk.Debugger.prototype.clear_breakpoint=function(t,e,n){n=this.generate_breakpoint_key(t,e,n);return hasOwnProperty(this.dbg_breakpoints,n)?(delete this.dbg_breakpoints[n],null):"Invalid breakpoint specified: "+t+" line: "+e},Sk.Debugger.prototype.clear_all_breakpoints=function(){this.dbg_breakpoints={},this.tmp_breakpoints={}},Sk.Debugger.prototype.set_ignore_count=function(t,e,n,s){t=this.generate_breakpoint_key(t,e,n);hasOwnProperty(this.dbg_breakpoints,t)&&(this.dbg_breakpoints[t].ignore_count=s)},Sk.Debugger.prototype.set_condition=function(t,e,n,s,i,o){var r=this.generate_breakpoint_key(t,e,n),t=hasOwnProperty(this.dbg_breakpoints,r)?this.dbg_breakpoints[r]:new Sk.Breakpoint(t,e,n);t.condition=new Sk.Condition(s,i,o),this.dbg_breakpoints[r]=t},Sk.Debugger.prototype.print_suspension_info=function(t){var e=t.filename,n=t.lineno,t=t.colno;this.print("Hit Breakpoint at <"+e+"> at line: "+n+" column: "+t+"\n"),this.print("----------------------------------------------------------------------------------\n"),this.print(" ==> "+this.get_source_line(n-1)+"\n"),this.print("----------------------------------------------------------------------------------\n")},Sk.Debugger.prototype.set_suspension=function(t){var e=null;for(!hasOwnProperty(t,"filename")&&t.child instanceof Sk.misceval.Suspension&&(t=t.child),0<this.suspension_stack.length&&(this.suspension_stack.pop(),--this.current_suspension);t instanceof Sk.misceval.Suspension;)e=t,this.suspension_stack.push(e),this.current_suspension+=1,t=t.child;t=e,this.print_suspension_info(t)},Sk.Debugger.prototype.add_breakpoint=function(t,e,n,s){var i=this.generate_breakpoint_key(t,e,n);this.dbg_breakpoints[i]=new Sk.Breakpoint(t,e,n),s&&(this.tmp_breakpoints[i]=!0)},Sk.Debugger.prototype.suspension_handler=function(n){return new Promise(function(t,e){try{t(n.resume())}catch(t){e(t)}})},Sk.Debugger.prototype.resume=function(){this.current_suspension=this.suspension_stack.length-1,0===this.suspension_stack.length?this.print("No running program"):this.suspension_handler(this.get_active_suspension()).then(this.success.bind(this),this.error.bind(this))},Sk.Debugger.prototype.pop_suspension_stack=function(){this.suspension_stack.pop(),--this.current_suspension},Sk.Debugger.prototype.success=function(t){t instanceof Sk.misceval.Suspension?this.set_suspension(t):0<this.suspension_stack.length?(this.pop_suspension_stack(),0===this.suspension_stack.length?this.print("Program execution complete"):(this.get_active_suspension().child.resume=function(){return t},this.resume())):this.print("Program execution complete")},Sk.Debugger.prototype.error=function(t){this.print("Traceback (most recent call last):");for(var e=0;e<t.traceback.length;++e){this.print('  File "'+t.traceback[e].filename+'", line '+t.traceback[e].lineno+", in <module>");var n=(n=this.get_source_line(t.traceback[e].lineno-1)).trim();this.print(n="    "+n)}for(var s=t.constructor.tp$name,e=0;e<t.args.v.length;++e)this.print(s+": "+t.args.v[e].v)},Sk.Debugger.prototype.asyncToPromise=function(t,e,s){return new Promise(function(e,n){try{!function(t){try{if(t instanceof Sk.misceval.Suspension)return s.set_suspension(t);e(t)}catch(t){n(t)}}(t())}catch(t){n(t)}})},Sk.Debugger.prototype.execute=function(t,e){t=t();t instanceof Sk.misceval.Suspension&&(this.suspensions.concat(t),this.eval_callback(t))},goog.exportSymbol("Sk.Debugger",Sk.Debugger);